<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centipede - Atari 1981</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            color: #fff;
        }
        
        #gameContainer {
            position: relative;
            border: 2px solid #0f0;
            box-shadow: 0 0 20px #0f0;
        }
        
        canvas {
            display: block;
            background: #000;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        #scoreDisplay {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 18px;
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
        }
        
        #livesDisplay {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 18px;
            color: #ff0;
            text-shadow: 0 0 5px #ff0;
        }
        
        #gameOverScreen, #startScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border: 2px solid #f00;
            box-shadow: 0 0 20px #f00;
        }
        
        h1 {
            color: #ff0;
            text-shadow: 0 0 10px #ff0;
            margin-bottom: 20px;
        }
        
        button {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 10px #0f0;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="scoreDisplay">SCORE: 0</div>
        <div id="livesDisplay">LIVES: 3</div>
        <div id="startScreen">
            <h1>CENTIPEDE</h1>
            <p style="color: #0f0; margin-bottom: 20px;">ARROW KEYS TO MOVE<br>SPACE TO SHOOT</p>
            <button onclick="startGame()">START GAME</button>
        </div>
        <div id="gameOverScreen" style="display: none;">
            <h1>GAME OVER</h1>
            <p style="color: #f00; font-size: 24px;" id="finalScore">FINAL SCORE: 0</p>
            <button onclick="restartGame()">PLAY AGAIN</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game constants
        const CELL_SIZE = 20;
        const GRID_WIDTH = 30;
        const GRID_HEIGHT = 30;
        const PLAYER_AREA_HEIGHT = 5; // Reduced player area to allow more playfield
        
        canvas.width = GRID_WIDTH * CELL_SIZE;
        canvas.height = GRID_HEIGHT * CELL_SIZE;
        
        // Game state
        let gameState = 'start';
        let score = 0;
        let lives = 3;
        let wave = 1;
        let extraLifeGiven = false;
        
        // Player
        const player = {
            x: Math.floor(GRID_WIDTH / 2),
            y: GRID_HEIGHT - 3,
            speed: 0.15,
            moveX: 0,
            moveY: 0
        };
        
        // Bullets
        let bullets = [];
        
        // Centipede segments
        let centipedes = [];
        
        // Mushrooms grid
        let mushrooms = [];
        
        // Enemies
        let fleas = [];
        let spiders = [];
        let scorpions = [];
        
        // Input handling
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (e.key === ' ' && gameState === 'playing') {
                e.preventDefault();
                shootBullet();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // Initialize mushrooms grid
        function initMushrooms() {
            mushrooms = [];
            for (let y = 5; y < GRID_HEIGHT - 2; y++) { // Allow mushrooms almost to bottom
                for (let x = 0; x < GRID_WIDTH; x++) {
                    if (Math.random() < 0.015) { // 1.5% chance of mushroom
                        mushrooms.push({
                            x: x,
                            y: y,
                            health: 4,
                            poisoned: false
                        });
                    }
                }
            }
        }
        
        // Create centipede
        function createCentipede(length = 12, startX = 0, startY = 0) {
            const centipede = [];
            for (let i = 0; i < length; i++) {
                centipede.push({
                    x: startX - i,
                    y: startY,
                    direction: 1,
                    isHead: i === 0
                });
            }
            return centipede;
        }
        
        // Initialize game
        function initGame() {
            score = 0;
            lives = 3;
            wave = 1;
            extraLifeGiven = false;
            
            player.x = Math.floor(GRID_WIDTH / 2);
            player.y = GRID_HEIGHT - 3;
            
            bullets = [];
            fleas = [];
            spiders = [];
            scorpions = [];
            
            initMushrooms();
            centipedes = [createCentipede(12, 10, 0)];
            
            updateDisplay();
        }
        
        // Start game
        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            gameState = 'playing';
            initGame();
            gameLoop();
        }
        
        // Restart game
        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            gameState = 'playing';
            initGame();
            gameLoop();
        }
        
        // Shoot bullet
        function shootBullet() {
            if (bullets.length < 3) { // Max 3 bullets on screen
                bullets.push({
                    x: player.x * CELL_SIZE + CELL_SIZE / 2,
                    y: player.y * CELL_SIZE,
                    speed: 8
                });
            }
        }
        
        // Update player movement
        function updatePlayer() {
            if (keys['ArrowLeft']) {
                player.moveX = -player.speed;
            } else if (keys['ArrowRight']) {
                player.moveX = player.speed;
            } else {
                player.moveX *= 0.8; // Deceleration
            }
            
            if (keys['ArrowUp'] && player.y > GRID_HEIGHT - PLAYER_AREA_HEIGHT) {
                player.moveY = -player.speed;
            } else if (keys['ArrowDown'] && player.y < GRID_HEIGHT - 2) {
                player.moveY = player.speed;
            } else {
                player.moveY *= 0.8; // Deceleration
            }
            
            player.x += player.moveX;
            player.y += player.moveY;
            
            // Boundaries
            player.x = Math.max(0, Math.min(GRID_WIDTH - 1, player.x));
            player.y = Math.max(GRID_HEIGHT - PLAYER_AREA_HEIGHT, Math.min(GRID_HEIGHT - 2, player.y));
        }
        
        // Update bullets
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.y -= bullet.speed;
                
                // Remove if off screen
                if (bullet.y < 0) {
                    bullets.splice(i, 1);
                    continue;
                }
                
                // Check collisions with mushrooms
                const gridX = Math.floor(bullet.x / CELL_SIZE);
                const gridY = Math.floor(bullet.y / CELL_SIZE);
                
                for (let j = mushrooms.length - 1; j >= 0; j--) {
                    const mushroom = mushrooms[j];
                    if (mushroom.x === gridX && mushroom.y === gridY) {
                        mushroom.health--;
                        
                        if (mushroom.health <= 0) {
                            mushrooms.splice(j, 1);
                            score += 10;
                        } else {
                            score += 5;
                        }
                        
                        bullets.splice(i, 1);
                        break;
                    }
                }
                
                // Check collisions with centipedes
                for (let c = centipedes.length - 1; c >= 0; c--) {
                    const centipede = centipedes[c];
                    
                    for (let s = centipede.length - 1; s >= 0; s--) {
                        const segment = centipede[s];
                        
                        if (Math.abs(segment.x * CELL_SIZE + CELL_SIZE/2 - bullet.x) < CELL_SIZE &&
                            Math.abs(segment.y * CELL_SIZE + CELL_SIZE/2 - bullet.y) < CELL_SIZE) {
                            
                            // Create mushroom at hit location
                            mushrooms.push({
                                x: segment.x,
                                y: segment.y,
                                health: 4,
                                poisoned: false
                            });
                            
                            if (segment.isHead) {
                                score += 100;
                            } else {
                                score += 10;
                            }
                            
                            // Split centipede if middle segment hit
                            if (s > 0 && s < centipede.length - 1) {
                                const newCentipede = centipede.splice(s + 1);
                                newCentipede[0].isHead = true;
                                centipedes.push(newCentipede);
                            }
                            
                            centipede.splice(s, 1);
                            
                            if (centipede.length === 0) {
                                centipedes.splice(c, 1);
                            } else if (s === 0 && centipede.length > 0) {
                                centipede[0].isHead = true;
                            }
                            
                            bullets.splice(i, 1);
                            break;
                        }
                    }
                }
                
                // Check collisions with fleas
                for (let i = fleas.length - 1; i >= 0; i--) {
                    const flea = fleas[i];
                    
                    if (Math.abs(flea.x * CELL_SIZE + CELL_SIZE/2 - bullet.x) < CELL_SIZE &&
                        Math.abs(flea.y * CELL_SIZE + CELL_SIZE/2 - bullet.y) < CELL_SIZE) {
                        
                        fleas.splice(i, 1);
                        score += 200;
                        bullets.splice(bullets.length - 1, 1);
                    }
                }
                
                // Check collisions with spiders
                for (let i = spiders.length - 1; i >= 0; i--) {
                    const spider = spiders[i];
                    
                    if (Math.abs(spider.x * CELL_SIZE + CELL_SIZE/2 - bullet.x) < CELL_SIZE &&
                        Math.abs(spider.y * CELL_SIZE + CELL_SIZE/2 - bullet.y) < CELL_SIZE) {
                        
                        spiders.splice(i, 1);
                        score += spider.y > GRID_HEIGHT - PLAYER_AREA_HEIGHT ? 600 : 300;
                        bullets.splice(bullets.length - 1, 1);
                    }
                }
                
                // Check collisions with scorpions
                for (let i = scorpions.length - 1; i >= 0; i--) {
                    const scorpion = scorpions[i];
                    
                    if (Math.abs(scorpion.x * CELL_SIZE + CELL_SIZE/2 - bullet.x) < CELL_SIZE &&
                        Math.abs(scorpion.y * CELL_SIZE + CELL_SIZE/2 - bullet.y) < CELL_SIZE) {
                        
                        scorpions.splice(i, 1);
                        score += 1000;
                        bullets.splice(bullets.length - 1, 1);
                    }
                }
            }
        }
        
        // Update centipedes
        function updateCentipedes() {
            for (const centipede of centipedes) {
                for (let i = 0; i < centipede.length; i++) {
                    const segment = centipede[i];
                    
                    if (i === 0) { // Head movement
                        segment.x += segment.direction * 0.1;
                        
                        // Check boundaries and obstacles
                        if (segment.x <= 0 || segment.x >= GRID_WIDTH - 1) {
                            segment.y++;
                            segment.direction *= -1;
                            segment.x = Math.max(0, Math.min(GRID_WIDTH - 1, segment.x));
                        }
                        
                        // Check mushroom collision
                        let hitMushroom = false;
                        for (const mushroom of mushrooms) {
                            if (Math.floor(segment.x + segment.direction * 0.1) === mushroom.x &&
                                Math.floor(segment.y) === mushroom.y) {
                                hitMushroom = true;
                                break;
                            }
                        }
                        
                        if (hitMushroom) {
                            segment.y++;
                            segment.direction *= -1;
                            
                            // If poisoned, move down faster
                            for (const mushroom of mushrooms) {
                                if (mushroom.x === Math.floor(segment.x) && 
                                    mushroom.y === Math.floor(segment.y) &&
                                    mushroom.poisoned) {
                                    segment.y += 2;
                                    break;
                                }
                            }
                        }
                        
                        // FIXED: Allow centipede to reach bottom of screen
                        if (segment.y >= GRID_HEIGHT - 1) {
                            segment.y = 0;
                            segment.x = Math.random() < 0.5 ? 0 : GRID_WIDTH - 1;
                        }
                    } else { // Body segments follow
                        const targetSegment = centipede[i - 1];
                        const dx = targetSegment.x - segment.x;
                        const dy = targetSegment.y - segment.y;
                        
                        if (Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5) {
                            segment.x += dx * 0.15;
                            segment.y += dy * 0.15;
                        }
                    }
                }
            }
        }
        
        // Spawn enemies
        function spawnEnemies() {
            // Spawn fleas
            if (Math.random() < 0.002 && fleas.length < 2) {
                fleas.push({
                    x: Math.floor(Math.random() * GRID_WIDTH),
                    y: 0,
                    speed: 0.05
                });
            }
            
            // Spawn spiders
            if (Math.random() < 0.003 && spiders.length < 1) {
                spiders.push({
                    x: Math.random() < 0.5 ? 0 : GRID_WIDTH - 1,
                    y: GRID_HEIGHT - PLAYER_AREA_HEIGHT + Math.floor(Math.random() * 5),
                    speedX: (Math.random() < 0.5 ? 1 : -1) * 0.08,
                    speedY: (Math.random() - 0.5) * 0.06
                });
            }
            
            // Spawn scorpions
            if (wave > 1 && Math.random() < 0.001 && scorpions.length < 1) {
                scorpions.push({
                    x: 0,
                    y: Math.floor(Math.random() * (GRID_HEIGHT - PLAYER_AREA_HEIGHT - 5)) + 2,
                    speed: 0.06
                });
            }
        }
        
        // Update enemies
        function updateEnemies() {
            // Update fleas
            for (let i = fleas.length - 1; i >= 0; i--) {
                const flea = fleas[i];
                flea.y += flea.speed;
                
                // Drop mushrooms
                if (Math.floor(flea.y) % 2 === 0 && Math.random() < 0.1) {
                    mushrooms.push({
                        x: Math.floor(flea.x),
                        y: Math.floor(flea.y),
                        health: 4,
                        poisoned: false
                    });
                }
                
                // FIXED: Allow fleas to drop all the way to bottom
                if (flea.y >= GRID_HEIGHT - 1) {
                    fleas.splice(i, 1);
                }
            }
            
            // Update spiders
            for (let i = spiders.length - 1; i >= 0; i--) {
                const spider = spiders[i];
                
                spider.x += spider.speedX;
                spider.y += spider.speedY;
                
                // Bounce off walls
                if (spider.x <= 0 || spider.x >= GRID_WIDTH - 1) {
                    spider.speedX *= -1;
                }
                
                // Keep in player area but allow more movement
                if (spider.y < GRID_HEIGHT - PLAYER_AREA_HEIGHT - 2) {
                    spider.speedY = Math.abs(spider.speedY);
                } else if (spider.y >= GRID_HEIGHT - 2) {
                    spider.speedY = -Math.abs(spider.speedY);
                }
                
                // Random direction change
                if (Math.random() < 0.02) {
                    spider.speedX *= -1;
                    spider.speedY = (Math.random() - 0.5) * 0.06;
                }
            }
            
            // Update scorpions
            for (let i = scorpions.length - 1; i >= 0; i--) {
                const scorpion = scorpions[i];
                scorpion.x += scorpion.speed;
                
                // Poison mushrooms
                for (const mushroom of mushrooms) {
                    if (Math.abs(mushroom.x - Math.floor(scorpion.x)) < 2 &&
                        Math.abs(mushroom.y - scorpion.y) < 1) {
                        mushroom.poisoned = true;
                    }
                }
                
                // Remove if reached other side
                if (scorpion.x >= GRID_WIDTH) {
                    scorpions.splice(i, 1);
                }
            }
        }
        
        // Check player collisions
        function checkPlayerCollisions() {
            // Check centipede collision
            for (const centipede of centipedes) {
                for (const segment of centipede) {
                    if (Math.abs(segment.x - player.x) < 1 && 
                        Math.abs(segment.y - player.y) < 1) {
                        loseLife();
                        return;
                    }
                }
            }
            
            // Check spider collision
            for (const spider of spiders) {
                if (Math.abs(spider.x - player.x) < 1 && 
                    Math.abs(spider.y - player.y) < 1) {
                    loseLife();
                    return;
                }
            }
            
            // Check flea collision
            for (const flea of fleas) {
                if (Math.abs(flea.x - player.x) < 1 && 
                    Math.abs(flea.y - player.y) < 1) {
                    loseLife();
                    return;
                }
            }
        }
        
        // Lose life
        function loseLife() {
            lives--;
            
            if (lives <= 0) {
                gameOver();
            } else {
                // Reset positions
                player.x = Math.floor(GRID_WIDTH / 2);
                player.y = GRID_HEIGHT - 3;
                bullets = [];
                
                // Flash effect
                ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            updateDisplay();
        }
        
        // Check wave completion
        function checkWaveComplete() {
            if (centipedes.length === 0) {
                wave++;
                
                // Bonus points for completing wave
                score += 100 * wave;
                
                // Create new centipede(s)
                const numCentipedes = Math.min(wave, 3);
                centipedes = [];
                
                for (let i = 0; i < numCentipedes; i++) {
                    const length = Math.max(8, 12 - wave);
                    const startX = i * (GRID_WIDTH / numCentipedes);
                    centipedes.push(createCentipede(length, startX, 0));
                }
                
                // Add more mushrooms throughout playfield
                for (let y = 5; y < GRID_HEIGHT - 2; y++) {
                    for (let x = 0; x < GRID_WIDTH; x++) {
                        if (Math.random() < 0.005) { // .5% chance of additional mushroom
                            mushrooms.push({
                                x: x,
                                y: y,
                                health: 4,
                                poisoned: false
                            });
                        }
                    }
                }
            }
        }
        
        // Update display
        function updateDisplay() {
            document.getElementById('scoreDisplay').textContent = `SCORE: ${score}`;
            document.getElementById('livesDisplay').textContent = `LIVES: ${lives}`;
            
            // Check for extra life
            if (score >= 12000 && !extraLifeGiven) {
                lives++;
                extraLifeGiven = true;
            }
        }
        
        // Game over
        function gameOver() {
            gameState = 'gameover';
            document.getElementById('finalScore').textContent = `FINAL SCORE: ${score}`;
            document.getElementById('gameOverScreen').style.display = 'block';
        }
        
        // Draw functions
        function drawPlayer() {
            ctx.save();
            
            const pixelX = player.x * CELL_SIZE + CELL_SIZE / 2;
            const pixelY = player.y * CELL_SIZE + CELL_SIZE / 2;
            
            // Draw gun base
            ctx.fillStyle = '#0ff';
            ctx.fillRect(pixelX - 6, pixelY - 4, 12, 8);
            
            // Draw gun barrel
            ctx.fillStyle = '#fff';
            ctx.fillRect(pixelX - 2, pixelY - 10, 4, 8);
            
            // Draw details
            ctx.fillStyle = '#f00';
            ctx.fillRect(pixelX - 4, pixelY - 2, 8, 4);
            
            ctx.restore();
        }
        
        function drawBullets() {
            ctx.fillStyle = '#ff0';
            for (const bullet of bullets) {
                ctx.fillRect(bullet.x - 2, bullet.y - 4, 4, 8);
                
                // Glow effect
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#ff0';
                ctx.fillRect(bullet.x - 1, bullet.y - 3, 2, 6);
                ctx.shadowBlur = 0;
            }
        }
        
        function drawCentipedes() {
            for (const centipede of centipedes) {
                for (let i = 0; i < centipede.length; i++) {
                    const segment = centipede[i];
                    const pixelX = segment.x * CELL_SIZE + CELL_SIZE / 2;
                    const pixelY = segment.y * CELL_SIZE + CELL_SIZE / 2;
                    
                    if (segment.isHead) {
                        // Draw head
                        ctx.fillStyle = '#ff0';
                        ctx.beginPath();
                        ctx.arc(pixelX, pixelY, CELL_SIZE / 2 - 1, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Eyes
                        ctx.fillStyle = '#f00';
                        const eyeOffset = segment.direction > 0 ? 3 : -3;
                        ctx.fillRect(pixelX + eyeOffset - 2, pixelY - 4, 4, 4);
                        ctx.fillRect(pixelX + eyeOffset - 2, pixelY + 1, 4, 4);
                    } else {
                        // Draw body segment
                        const colors = ['#0f0', '#8f8', '#5f5'];
                        ctx.fillStyle = colors[i % 3];
                        ctx.beginPath();
                        ctx.arc(pixelX, pixelY, CELL_SIZE / 2 - 2, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Segment detail
                        ctx.strokeStyle = '#fff';
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                }
            }
        }
        
        function drawMushrooms() {
            for (const mushroom of mushrooms) {
                const pixelX = mushroom.x * CELL_SIZE + CELL_SIZE / 2;
                const pixelY = mushroom.y * CELL_SIZE + CELL_SIZE / 2;
                
                // Color based on health and poison
                if (mushroom.poisoned) {
                    ctx.fillStyle = '#f0f';
                } else if (mushroom.health === 4) {
                    ctx.fillStyle = '#f80';
                } else if (mushroom.health === 3) {
                    ctx.fillStyle = '#fa0';
                } else if (mushroom.health === 2) {
                    ctx.fillStyle = '#fc0';
                } else {
                    ctx.fillStyle = '#fe0';
                }
                
                // Draw mushroom cap
                ctx.beginPath();
                ctx.arc(pixelX, pixelY - 3, CELL_SIZE / 2 - 1, Math.PI, 0);
                ctx.fill();
                
                // Draw stem
                ctx.fillRect(pixelX - 2, pixelY - 3, 4, 6);
                
                // Draw spots on cap
                if (mushroom.health > 1) {
                    ctx.fillStyle = mushroom.poisoned ? '#fff' : '#000';
                    ctx.beginPath();
                    ctx.arc(pixelX - 4, pixelY - 5, 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(pixelX + 4, pixelY - 5, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }
        
        function drawFleas() {
            for (const flea of fleas) {
                const pixelX = flea.x * CELL_SIZE + CELL_SIZE / 2;
                const pixelY = flea.y * CELL_SIZE + CELL_SIZE / 2;
                
                // Draw flea body
                ctx.fillStyle = '#0ff';
                ctx.fillRect(pixelX - 4, pixelY - 6, 8, 12);
                
                // Draw legs
                ctx.strokeStyle = '#0ff';
                ctx.lineWidth = 1;
                for (let i = -3; i <= 3; i += 2) {
                    ctx.beginPath();
                    ctx.moveTo(pixelX + i, pixelY - 4);
                    ctx.lineTo(pixelX + i - 3, pixelY - 8);
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(pixelX + i, pixelY + 4);
                    ctx.lineTo(pixelX + i - 3, pixelY + 8);
                    ctx.stroke();
                }
                
                // Draw eyes
                ctx.fillStyle = '#f00';
                ctx.fillRect(pixelX - 2, pixelY - 5, 4, 2);
            }
        }
        
        function drawSpiders() {
            for (const spider of spiders) {
                const pixelX = spider.x * CELL_SIZE + CELL_SIZE / 2;
                const pixelY = spider.y * CELL_SIZE + CELL_SIZE / 2;
                
                // Draw spider body
                ctx.fillStyle = '#f0f';
                ctx.beginPath();
                ctx.ellipse(pixelX, pixelY, 6, 4, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw head
                ctx.beginPath();
                ctx.arc(pixelX - 5, pixelY, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw legs
                ctx.strokeStyle = '#f0f';
                ctx.lineWidth = 1;
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2;
                    const legLength = 8;
                    
                    ctx.beginPath();
                    ctx.moveTo(pixelX, pixelY);
                    ctx.lineTo(
                        pixelX + Math.cos(angle) * legLength,
                        pixelY + Math.sin(angle) * legLength
                    );
                    ctx.stroke();
                }
                
                // Draw eyes
                ctx.fillStyle = '#000';
                ctx.fillRect(pixelX - 6, pixelY - 1, 2, 2);
            }
        }
        
        function drawScorpions() {
            for (const scorpion of scorpions) {
                const pixelX = scorpion.x * CELL_SIZE + CELL_SIZE / 2;
                const pixelY = scorpion.y * CELL_SIZE + CELL_SIZE / 2;
                
                // Draw scorpion body segments
                ctx.fillStyle = '#f00';
                for (let i = 0; i < 5; i++) {
                    ctx.beginPath();
                    ctx.arc(pixelX - i * 3, pixelY, 4 - i * 0.5, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Draw tail
                ctx.strokeStyle = '#f00';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(pixelX - 15, pixelY);
                ctx.quadraticCurveTo(pixelX - 20, pixelY - 5, pixelX - 18, pixelY - 10);
                ctx.stroke();
                
                // Draw stinger
                ctx.fillStyle = '#ff0';
                ctx.beginPath();
                ctx.arc(pixelX - 18, pixelY - 10, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw claws
                ctx.strokeStyle = '#f00';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(pixelX + 4, pixelY);
                ctx.lineTo(pixelX + 6, pixelY - 3);
                ctx.lineTo(pixelX + 8, pixelY - 2);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(pixelX + 4, pixelY);
                ctx.lineTo(pixelX + 6, pixelY + 3);
                ctx.lineTo(pixelX + 8, pixelY + 2);
                ctx.stroke();
            }
        }
        
        function drawGrid() {
            // Draw subtle grid lines
            ctx.strokeStyle = 'rgba(0, 255, 0, 0.05)';
            ctx.lineWidth = 1;
            
            for (let x = 0; x <= GRID_WIDTH; x++) {
                ctx.beginPath();
                ctx.moveTo(x * CELL_SIZE, 0);
                ctx.lineTo(x * CELL_SIZE, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= GRID_HEIGHT; y++) {
                ctx.beginPath();
                ctx.moveTo(0, y * CELL_SIZE);
                ctx.lineTo(canvas.width, y * CELL_SIZE);
                ctx.stroke();
            }
        }
        
        // Main game loop
        function gameLoop() {
            if (gameState !== 'playing') return;
            
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            drawGrid();
            
            // Update game objects
            updatePlayer();
            updateBullets();
            updateCentipedes();
            spawnEnemies();
            updateEnemies();
            checkPlayerCollisions();
            checkWaveComplete();
            
            // Draw everything
            drawMushrooms();
            drawCentipedes();
            drawFleas();
            drawSpiders();
            drawScorpions();
            drawBullets();
            drawPlayer();
            
            // Update display
            updateDisplay();
            
            // Continue game loop
            requestAnimationFrame(gameLoop);
        }
        
        // Initialize on load
        window.onload = () => {
            console.log('Centipede Game Loaded');
            console.log('Controls: Arrow Keys to move, Space to shoot');
            console.log('Fixed: Centipedes and fleas now reach bottom of screen');
            console.log('Fixed: Mushrooms spawn throughout entire playfield');
        };
    </script>
</body>
</html>